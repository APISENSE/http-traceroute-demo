!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Apisense=t()}}(function(){return function t(r,e,o){function n(a,s){if(!e[a]){if(!r[a]){var f="function"==typeof require&&require;if(!s&&f)return f(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=e[a]={exports:{}};r[a][0].call(d.exports,function(t){var e=r[a][1][t];return n(e||t)},d,d.exports,t,r,e,o)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(t,r,e){},{}],2:[function(t,r,e){"use strict";r.exports=function(){function t(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.id=t,this.settings={honeycomb:"https://honeycomb.apisense.io/"},this.cropData=[],void 0===r&&null===r||("honeycomb"in r&&(this.settings.honeycomb=r.honeycomb),"accessKey"in r&&(this.settings.accessKey=r.accessKey),"filter"in r&&(this.settings.filter=r.filter)),this}var r=function(t,r,e){var o=new XMLHttpRequest;o.open("GET",t,!0),r&&o.setRequestHeader("Authorization","accessKey "+r),o.onload=function(t){if(200===o.status){var r=JSON.parse(o.responseText);e(r)}},o.onerror=function(t){console.error(o.statusText)},o.send(null)};return t.prototype={getDataUrl:function(){return this.settings.filter?this.settings.honeycomb+"api/v1/crop/"+this.id+"/data/"+this.settings.filter:this.settings.honeycomb+"api/v1/crop/"+this.id+"/data"},getRecords:function(t){var e=this,o=this;return new Promise(function(t,n){if(0===o.cropData.length)return r(o.getDataUrl(),o.settings.accessKey,function(r){if(e.settings.filter)o.cropData=r;else for(var n=0;n<r.length;n++)for(var i=r[n].body,a=0;a<i.length;a++)o.cropData.push(i[a]);t(o.cropData)});t(o.cropData)})}},t}()},{}],3:[function(t,r,e){"use strict";r.exports={Crop:t("crop.js"),Visualization:t("visualization.js")}},{"crop.js":2,"visualization.js":5}],4:[function(t,r,e){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.exports=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function r(t,r){return t.x-r.x}var e={},n=["DATE_FORMAT"];return e.validateData=function(e){if("object"!=(void 0===e?"undefined":o(e)))throw new Error("Invalid data format");var n=[];return Object.keys(e).forEach(function(i){var a=e[i];if(Array.isArray(a)){for(var s=0;s<a.length;s++){var f=e[i][s];if(!("object"==(void 0===f?"undefined":o(f))&&"x"in f&&"y"in f&&void 0!==f.x&&void 0!==f.y&&t(f.x)&&t(f.y)))throw new Error("Invalid data format")}n.push({id:i,data:a.sort(r)})}else{for(var u=[],d=Object.keys(a),l=0;l<d.length;l++){var c=d[l],p=a[c];if(void 0===p||!t(c)||!t(p))throw new Error("Invalid data format");u.push({x:c,y:p})}n.push({id:i,data:u.sort(r)})}}),n},e.validateLabels=function(t){var r={};if("object"!=(void 0===t?"undefined":o(t)))throw new Error("Invalid data format");for(var e in t)if("xAxis"==e){if(!("string"==typeof t.xAxis&&n.includes(t.xAxis)||"object"==o(t.xAxis)))throw new Error("Invalid data format");r.xAxis=t.xAxis}else if("yAxis"==e){if(!("string"==typeof t.yAxis&&n.includes(t.yAxis)||"object"==o(t.yAxis)))throw new Error("Invalid data format");r.yAxis=t.yAxis}else{if("string"!=typeof t[e])throw new Error("Invalid data format");r[e]=t[e]}return r},e.validateColors=function(t){var r=/(^#?[0-9A-F]{6}$)|(^#?[0-9A-F]{8}$)|(^#?[0-9A-F]{3}$)/i,e={};if("object"!=(void 0===t?"undefined":o(t)))throw new Error("Invalid data format");for(var n in t){var i=t[n];if("string"==typeof i&&r.test(i))e[n]=i;else{if("object"!=(void 0===i?"undefined":o(i)))throw new Error("Invalid data format");e[n]={};for(var a in i){if(!r.test(i[a]))throw new Error("Invalid data format");e[n][a]=i[a]}}}return e},e}()},{}],5:[function(t,r,e){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.exports=function(){var r=t("chart.js");if(!(r="function"==typeof r?r:window.Chart))throw new Error("Apisense - Chart.js could not be found! You must include it before Apisense");var e={},n=t("validator.js"),i=function(t,r){return t.x-r.x},a=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),o=e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:"176",g:"190",b:"197"};return"rgba("+o.r+","+o.g+","+o.b+","+r+")"},s=function(t,r,e,n,s){var f={type:t,data:{},options:{}};"line"!=t&&"bar"!=t||(f.options.scales={xAxes:[{type:"linear"}],yAxes:[{type:"linear"}]}),s&&(f.options.title={display:!0,text:s});var u=void 0;if("xAxis"in n){if("DATE_FORMAT"==n.xAxis&&(f.options.scales.xAxes[0].type="time"),"object"==o(n.xAxis)){for(var d=[],l=new Set,c=0;c<r.length;c++)for(var p=r[c].data,v=0;v<p.length;v++)l.add(p[v].x);u=Array.from(l).sort();var h=!0,y=!1,b=void 0;try{for(var x,g=u[Symbol.iterator]();!(h=(x=g.next()).done);h=!0){var m=x.value,w=n.xAxis[m];d.push(w||m)}}catch(t){y=!0,b=t}finally{try{!h&&g.return&&g.return()}finally{if(y)throw b}}f.data.labels=d,"line"!=t&&"bar"!=t||(f.options.scales.xAxes=void 0)}}else if("pie"==t){for(var A=new Set,C=0;C<r.length;C++)for(var j=r[C].data,D=0;D<j.length;D++)A.add(j[D].x);u=Array.from(A).sort(),f.data.labels=u}for(var E=[],S=0;S<r.length;S++){var I=r[S],L=r[S].data.sort(i),F={label:I.id,backgroundColor:a(""),borderColor:a("",1),borderWidth:1};if(u){for(var O=[],T=0,k=0;k<u.length;k++)T<L.length&&L[T].x==u[k]?(O.push(L[T].y),T++):O.push(null);F.data=O,F.spanGaps=!0}else F.data=L;if(I.id in n&&(F.label=n[I.id]),I.id in e&&("string"==typeof e[I.id]&&(F.backgroundColor=a(e[I.id]),F.borderColor=a(e[I.id],1)),"object"==o(e[I.id])))if(F.backgroundColor=[],F.borderColor=[],F.borderWidth=[],u)for(var q in u){var R=e[I.id][u[q]];F.backgroundColor.push(a(R)),F.borderColor.push(a(R,1)),F.borderWidth.push(1)}else for(var _ in L){var K=e[I.id][_.x];F.backgroundColor.push(a(K)),F.borderColor.push(a(K,1)),F.borderWidth.push(1)}E.push(F)}return f.data.datasets=E,f.options.showLines=!0,f},f=function(){var t={},r=[],e={},o={};return t.getData=function(){return r},t.setData=function(t){r=n.validateData(t)},t.getLabels=function(){return e},t.setLabels=function(t){e=n.validateLabels(t)},t.getColors=function(){return o},t.setColors=function(t){o=n.validateColors(t)},t};e._newChart=function(t,e){return new r(t,e)};var u=function(t,r,o,n,i){return new Promise(function(a,u){o.getRecords().then(function(o){var u=f();i(u,o);var d=s(t,u.getData(),u.getColors(),u.getLabels(),n);a(e._newChart(r,d))})})};return e.addLineChart=function(t,r,e,o){return u("line",t,r,e,o)},e.addBarChart=function(t,r,e,o){return u("bar",t,r,e,o)},e.addPieChart=function(t,r,e,o){return u("pie",t,r,e,o)},e}()},{"chart.js":1,"validator.js":4}]},{},[3])(3)});